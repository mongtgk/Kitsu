# Контракт RBAC

## Роли и разрешения
| Роль | Разрешения |
| --- | --- |
| guest | `read:content` |
| user | `read:profile`, `write:profile`, `read:content`, `write:content` |
| admin | все базовые разрешения + `admin:*` |

- Определение роли: `guest` без пользователя, `user` по умолчанию, `admin` при явном поле `role` либо `is_admin`/`is_superuser`.
- Базовые роли и права заданы в `app/auth/rbac.py`, матрица принудительного применения — `app/auth/enforcement_matrix.py`; актуальное сопоставление маршрутов и прав фиксируется в `docs/RBAC_CONTRACTS.md`.

## Где применяется
- Только backend: зависимости `get_current_role` + `require_enforced_permission` проверяют Bearer-токен и матрицу, при недостаточных правах возвращают 403.
- Frontend использует роль/права **только** для UX (видимость/disabled, подсказки). Без backend-проверки доступ не считается закрытым.

## Что обязательно для новых эндпоинтов
- Любой маршрут, требующий ограничений, должен быть добавлен в `ENFORCEMENT_MATRIX` и отражён в `docs/RBAC_CONTRACTS.md` до мерджа.
- При добавлении функциональности для parser/player (этап P2) сначала фиксируется требуемая роль/право, затем включается backend-guard; UI меняется только после наличия серверного контракта.

## Что фронтенд не делает
- Не выполняет deny/redirect самостоятельно без серверного решения; любые «клиентские стражи» считаются вспомогательными.
- Не пытается эмулировать RBAC, не кеширует права дольше жизни access token.
- Не скрывает серверные ошибки 401/403: они должны обрабатываться, но не подменяться успехом.
